const data = {
    "https://www.plainscapital.com/current-rates/": {
        "selector": 'body > div.mm-page > div.wrapper > section.page-content > div > div',
        "content": `<div class="row">
        <div class="col-md-8">
            

                

<div id="expand" data-collapse="">
<a class="expandTrigger open"><i class="fa fa-plus-circle"></i>CD Specials Rates</a>
<div class="expand open">
    <p>&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;</p>
<table role="presentation">
<tbody>
<tr>
<td></td>
<td>
<h4>Interest Rates</h4>
</td>
<td>
<h4>Annual&nbsp;<br>Percentage Yield</h4>
</td>
</tr>
<tr>
<td>
<p>6&nbsp;Month CD Special</p>
</td>
<td>
<p>1.50%</p>
</td>
<td>
<p>1.51%</p>
</td>
</tr>
</tbody>
</table>
<p></p>
<p><span class="footnote">All rates subject to change at bank's discretion.</span><br><span class="footnote">The annual percentage yield quoted above is current as of October 12, 2018. Interest rate is 1.50% for 6 months. All rates are subject to change at Bank’s discretion. A deposit account with direct deposit or bill pay is required. CD renews automatically with current 180-354 day CD rate at time of expiration. Interest will be paid at maturity. A penalty will be imposed for early withdrawal and will reduce earnings. Fees could reduce earnings on the account. $1,000 minimum balance required to open CD and to obtain this APY. Some restrictions apply.</span></p>
<div class="grammarly-disable-indicator"></div>
</div> 
<a class="expandTrigger open"><i class="fa fa-plus-circle"></i>Individual Retirement Account Rates</a>
<div class="expand open">
    <table role="presentation">
<tbody>
<tr>
<td>
<h4>$100 Minimum*</h4>
</td>
<td>
<h4>Interest Rate</h4>
</td>
<td>
<h4>Annual <br>Percentage Yield</h4>
</td>
</tr>
<tr>
<td>
<p class="p1">1 Year</p>
</td>
<td>
<p class="p1">1.85%</p>
</td>
<td>
<p class="p1">1.86%</p>
</td>
</tr>
<tr>
<td>
<p>2 Years</p>
</td>
<td>
<p class="p1">2.10%</p>
</td>
<td>
<p>2.11%</p>
</td>
</tr>
<tr>
<td>
<p>3 Years</p>
</td>
<td>
<p>2.30%</p>
</td>
<td>
<p>2.32%</p>
</td>
</tr>
<tr>
<td>
<p>4 Years</p>
</td>
<td>
<p>2.40%</p>
</td>
<td>
<p>2.42%</p>
</td>
</tr>
<tr>
<td>
<p>5 Years</p>
</td>
<td>
<p>2.50%</p>
</td>
<td>
<p>2.52%</p>
<p></p>
</td>
</tr>
</tbody>
</table>
<p></p>
<p></p>
<p><span class="footnote">1. A fee will be imposed for early withdrawal. Fees could reduce the earnings on the account.</span><br><span class="footnote">2. $100 minimum is required to open <g class="gr_ gr_19 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Grammar only-ins doubleReplace replaceWithoutSep" id="19" data-gr-id="19">account</g>.</span><br><span class="footnote">*Balances to obtain annual percentage yield</span></p>
</div> 
<a class="expandTrigger open"><i class="fa fa-plus-circle"></i>Certificates of Deposit Rates</a>
<div class="expand open">
    <table role="presentation">
<tbody>
<tr>
<td>
<h4>$1,000 Minimum*</h4>
</td>
<td>
<h4>Interest Rates</h4>
</td>
<td>
<h4>Annual&nbsp;<br>Percentage Yield</h4>
</td>
</tr>
<tr>
<td>
<p>7-29 Days</p>
</td>
<td>
<p>0.25%</p>
</td>
<td>
<p>0.25%</p>
</td>
</tr>
<tr>
<td>
<p>30-59 Days</p>
</td>
<td>
<p>0.30%</p>
</td>
<td>
<p>0.30%</p>
</td>
</tr>
<tr>
<td>
<p>60-89 Days</p>
</td>
<td>
<p>0.35%</p>
</td>
<td>
<p>0.35%</p>
</td>
</tr>
<tr>
<td>
<p>90-179 Days</p>
</td>
<td>
<p>0.45%</p>
</td>
<td>
<p>0.45%</p>
</td>
</tr>
<tr>
<td>
<p class="p1">180-364 Days</p>
</td>
<td>
<p>0.85%</p>
</td>
<td>
<p>0.85%</p>
</td>
</tr>
<tr>
<td>
<p class="p1">1 Year Fixed or Variable</p>
</td>
<td>
<p>1.85%</p>
</td>
<td>
<p>1.86%</p>
</td>
</tr>
<tr>
<td>
<p class="p1">2 Years</p>
</td>
<td>
<p>2.10%</p>
</td>
<td>
<p>2.11%</p>
</td>
</tr>
<tr>
<td>
<p class="p1">3 Years</p>
</td>
<td>
<p>2.30%</p>
</td>
<td>
<p>2.32%</p>
</td>
</tr>
<tr>
<td>
<p class="p1">4 Years</p>
</td>
<td>
<p>2.40%</p>
</td>
<td>
<p>2.42%</p>
</td>
</tr>
<tr>
<td>
<p class="p1">5 Years</p>
</td>
<td>
<p>2.50%</p>
</td>
<td>
<p>2.52%</p>
</td>
</tr>
</tbody>
</table>
<p></p>
<p><span class="footnote">1. For variable rate accounts, the rate may change after the account is opened.</span><br><span class="footnote">2. $1,000 minimum is required to open <g class="gr_ gr_34 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Grammar only-ins doubleReplace replaceWithoutSep" id="34" data-gr-id="34">account</g>.</span><br><span class="footnote">3. A fee will be imposed for early withdrawal from CDs.</span><br><span class="footnote">4. Fees could reduce the earnings on the account.</span><br><span class="footnote">5.&nbsp;All interest is compounded quarterly and can be paid out or capitalized quarterly based on customer’s discretion. Interest payments requested on a basis more frequent than quarterly will have a reduced interest rate.</span><br><span class="footnote">*Daily Minimum Balance to obtain annual percentage yield</span></p>
</div> 
<a class="expandTrigger open"><i class="fa fa-plus-circle"></i>Personal Savings Account Rates</a>
<div class="expand open">
    <table role="presentation">
<tbody>
<tr>
<td>
<h4>$100 Minimum*</h4>
</td>
<td>
<h4>Interest Rate</h4>
</td>
<td>
<h4>Annual&nbsp;<br>Percentage Yield</h4>
</td>
</tr>
<tr>
<td>
<p>Balances $100+</p>
</td>
<td>
<p>0.10%</p>
</td>
<td>
<p>0.10%</p>
</td>
</tr>
</tbody>
</table>
<p></p>
<p><span class="footnote">1. &nbsp;Fees may reduce earnings.</span><br><span class="footnote">2.&nbsp; Rate may change after the account is opened.</span><br><span class="footnote">3. $100 minimum is required to open <g class="gr_ gr_13 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Grammar only-ins doubleReplace replaceWithoutSep" id="13" data-gr-id="13">account</g>.</span><br><span class="footnote">* Daily Minimum Balance to obtain annual percentage yield</span></p>
</div> 
<a class="expandTrigger open"><i class="fa fa-plus-circle"></i>Youth Savings Program Rates</a>
<div class="expand open">
    <table role="presentation">
<tbody>
<tr>
<td>
<h4>$1 Minimum*</h4>
</td>
<td>
<h4>Interest Rate</h4>
</td>
<td>
<h4>Annual&nbsp;<br>Percentage Yield</h4>
</td>
</tr>
<tr>
<td>
<p>Balances $1+</p>
</td>
<td>
<p>0.10%</p>
</td>
<td>
<p>0.10%</p>
</td>
</tr>
</tbody>
</table>
<p></p>
<p><span class="footnote">1. &nbsp;Fees may reduce earnings.</span><br><span class="footnote">2.&nbsp; Rate may change after the account is opened.</span><br><span class="footnote">3. $1 minimum is required to open <g class="gr_ gr_22 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Grammar only-ins doubleReplace replaceWithoutSep" id="22" data-gr-id="22">account</g>.<br>4.&nbsp;<span>Only available to children under age 18</span><br>5.&nbsp;<span><g class="gr_ gr_20 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Grammar only-ins doubleReplace replaceWithoutSep" id="20" data-gr-id="20">Child</g> must have a parent or guardian age 18 or older as a co-owner of their account. When account owner turns 18, the account terms and structure will revert to Personal Savings. For more information, please go to&nbsp;<a href="https://www.plainscapital.com//personal/banking/savings-money-market/youth-savings-program/" target="_blank" rel="noopener noreferrer">https://www.plainscapital.com//personal/banking/savings-money-market/youth-savings-program/</a><br><br></span></span></p>
<p><span class="footnote">* Daily Minimum Balance to obtain annual percentage yield</span></p>
</div> 
<a class="expandTrigger open"><i class="fa fa-plus-circle"></i>PremierAccess Checking Rates</a>
<div class="expand open">
    <table role="presentation">
<tbody>
<tr>
<td>
<h4>$5,000 Minimum*</h4>
</td>
<td>
<h4>Interest Rate</h4>
</td>
<td>
<h4>Annual&nbsp;<br>Percentage Yield</h4>
</td>
</tr>
<tr>
<td>
<p>$5,000 - $24,999</p>
</td>
<td>
<p>0.10%</p>
</td>
<td>
<p>0.10%</p>
</td>
</tr>
<tr>
<td>
<p>$25,000 - $99,999</p>
</td>
<td>
<p>0.15%</p>
</td>
<td>
<p>0.15%</p>
</td>
</tr>
<tr>
<td>
<p>$100,000-$499,999</p>
</td>
<td>
<p>0.20%</p>
</td>
<td>
<p>0.20%</p>
</td>
</tr>
<tr>
<td>
<p>$500,000 +</p>
</td>
<td>
<p>0.25%</p>
</td>
<td>
<p>0.25%</p>
</td>
</tr>
</tbody>
</table>
<p></p>
<p><span class="footnote">1. Fees may reduce earnings.</span><br><span class="footnote">2. Rate may change after the account is opened.</span><br><span class="footnote">3. $100 minimum is required to open <g class="gr_ gr_10 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Grammar only-ins doubleReplace replaceWithoutSep" id="10" data-gr-id="10">account</g>.</span><br><span class="footnote">* Daily Minimum Balance to obtain annual percentage yield</span></p>
</div> 
<a class="expandTrigger open"><i class="fa fa-plus-circle"></i>Business Interest Rates</a>
<div class="expand open">
    <table role="presentation">
<tbody>
<tr>
<td>
<p style="text-align: center;"></p>
<h4 style="text-align: center;">$1,500 Minimum*</h4>
</td>
<td>
<h4>Interest Rate</h4>
</td>
<td>
<h4>Annual&nbsp;<br>Percentage Yield</h4>
</td>
</tr>
<tr>
<td>
<p>Balances $1,500+</p>
</td>
<td>
<p>0.10%</p>
</td>
<td>
<p>0.10%</p>
</td>
</tr>
</tbody>
</table>
<p></p>
<p><span class="footnote">&nbsp;</span></p>
<p><span class="footnote">1. Fees may reduce earnings.</span><br><span class="footnote">2. Rate may change after the account is opened.</span><br><span class="footnote">3. $1,500 minimum is required to open <g class="gr_ gr_10 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Grammar only-ins doubleReplace replaceWithoutSep" id="10" data-gr-id="10">account</g>.</span><br><span class="footnote">* Daily Minimum Balance to obtain annual percentage yield</span></p>
</div> 
<a class="expandTrigger open"><i class="fa fa-plus-circle"></i>Money Market Rates</a>
<div class="expand open">
    <table role="presentation">
<tbody>
<tr>
<td>
<h4>$2,500 Minimum*</h4>
</td>
<td>
<h4>Interest Rate</h4>
</td>
<td>
<h4>Annual&nbsp;<br>Percentage Yield</h4>
</td>
</tr>
<tr>
<td>
<p>$2,500 - $4,999</p>
</td>
<td>
<p>0.25%</p>
</td>
<td>
<p>0.25%</p>
</td>
</tr>
<tr>
<td>
<p>$5,000 - $24,999</p>
</td>
<td>
<p>0.35%</p>
</td>
<td>
<p>0.35%</p>
</td>
</tr>
<tr>
<td>
<p>$25,000-$99,999</p>
</td>
<td>
<p>0.45%</p>
</td>
<td>
<p>0.45%</p>
</td>
</tr>
<tr>
<td>
<p>$100,000-$499,999</p>
</td>
<td>
<p>0.70%</p>
</td>
<td>
<p>0.70%</p>
</td>
</tr>
<tr>
<td>
<p>$500,000-$999,999</p>
</td>
<td>
<p>0.75%</p>
</td>
<td>
<p>0.75%</p>
</td>
</tr>
<tr>
<td>
<p>$1,000,000-$1,999,999</p>
</td>
<td>
<p>0.85%</p>
</td>
<td>
<p>0.85%</p>
</td>
</tr>
<tr>
<td>
<p>$2,000,000-$4,999,999</p>
</td>
<td>
<p>0.90%</p>
</td>
<td>
<p>0.90%</p>
</td>
</tr>
<tr>
<td>
<p>$5,000,000 and above</p>
</td>
<td>
<p>1.00%</p>
</td>
<td>
<p>1.00%</p>
</td>
</tr>
</tbody>
</table>
<p></p>
<p><span class="footnote">1. Fees may reduce earnings.</span><br><span class="footnote">2. Rate may change after the account is opened.</span><br><span class="footnote">3. $2,500 minimum is required to open <g class="gr_ gr_10 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Grammar only-ins doubleReplace replaceWithoutSep" id="10" data-gr-id="10">account</g>.</span><br><span class="footnote">* Daily Minimum Balance to obtain annual percentage yield</span></p>
</div> 
<a class="expandTrigger open"><i class="fa fa-plus-circle"></i>Health Savings Account Rates</a>
<div class="expand open">
    <table role="presentation">
<tbody>
<tr>
<td>
<h4>$100 Minimum*</h4>
</td>
<td>
<h4>Interest Rate</h4>
</td>
<td>
<h4>Annual&nbsp;<br>Percentage Yield</h4>
</td>
</tr>
<tr>
<td>
<p>All Balances&nbsp;</p>
</td>
<td>
<p>0.05%</p>
</td>
<td>
<p>0.05%</p>
</td>
</tr>
</tbody>
</table>
<p></p>
<p><span class="footnote">1. &nbsp;Fees may reduce earnings.</span><br><span class="footnote">2.&nbsp; Rate may change after the account is opened.</span><br><span class="footnote">* $100 minimum is required to open account.</span><br><span class="footnote"><br></span></p>
</div> 
<a class="expandTrigger open"><i class="fa fa-plus-circle"></i>Coverdell Education Savings Account Rates</a>
<div class="expand open">
    <table role="presentation">
<tbody>
<tr>
<td>
<h4>$100 Minimum*</h4>
</td>
<td>
<h4>Interest Rate</h4>
</td>
<td>
<h4>Annual&nbsp;<br>Percentage Yield</h4>
</td>
</tr>
<tr>
<td>
<p>1 Year</p>
</td>
<td>
<p>0.50%</p>
</td>
<td>
<p>0.50%</p>
</td>
</tr>
<tr>
<td>
<p>2 Year</p>
</td>
<td>
<p>0.55%</p>
</td>
<td>
<p>0.55%</p>
</td>
</tr>
<tr>
<td>
<p>3 Year</p>
</td>
<td>
<p>0.60%</p>
</td>
<td>
<p>0.60%</p>
</td>
</tr>
<tr>
<td>
<p>4 Year</p>
</td>
<td>
<p>0.70%</p>
</td>
<td>
<p>0.70%</p>
</td>
</tr>
<tr>
<td>
<p>5 Year</p>
</td>
<td>
<p>0.80%</p>
</td>
<td>
<p>0.80%</p>
</td>
</tr>
</tbody>
</table>
<p></p>
<p><span class="footnote">1. &nbsp;Fees may reduce earnings.</span><br><span class="footnote">2.&nbsp; Rate may change after the account is opened.</span><br><span class="footnote">3. $100 minimum is required to open account.</span><br><span class="footnote">* Annual percentage yield earned on all balances.</span></p>
</div> 
</div>                    
        </div>
        <div class="col-xs-12">
                <div>
                The rate and annual percentage yield are accurate as of 11/22/2018.
                </div>
        </div>
        <div class="col-xs-12">	
            <p>Rate and APY are subject to change without notice.</p>					
        </div>
    </div>`
    },
    "https://apps.pnc.com/rates/servlet/DepositRatesSearch?productGroup=mmarket": {
        "selector": '#conMMDiv',
        "content": `<div class="resultsDiv" id="conMMDiv" style="padding: 5px; display: block;">
                    <div>
                    
                                                      
                    </div>
                    <div class="accordion-parsys limited-parsys">
                        <div class="accordion section" style="padding: 1px">
                            <div class="accordion-elements-parsys elements">
                                <div class="accordion-element section ratesBlockCommon" id="currentRatesBlockMoneyMarket">
                                    <a name="currentRates" id="currentRates"></a>
                                    <h3 class="subheading">
                                    Current Rates
                                    <span class="toggle fa-minus-circle"></span>
                                    </h3>
                                    <div class="accordion-content" data-expanded="true" style="display: block;">
                                    <div>
                                    <!-- check for Premiere Money Market(M0) product -->
                                    
                                    
                                        
                                            
                                        
                                    
                                        
                                    
                                        
                                    
                                    
                                        <table cellpadding="0" cellspacing="0">
                                            <tbody><tr>
        
                                                <th class="l orangeText"><span style="color: #f38025; font-size: 12pt; font-weight: normal; text-align: left">Premiere
                                                        Money Market Account</span> </th>
        
                                            </tr>
                                        </tbody></table>
                                    
                                </div>
                        <div>
                            <table cellpadding="0" cellspacing="0">
                                
                                    
                                                                               
                                        </table><table cellpadding="0" cellspacing="0">	
                                        <tbody><tr class="prodHeader headingtext">
                                        <th></th>
                                         
                                              
                                                
                                                   
                                                      <th class="" colspan="2" align="center" style="font-size: 12px;">Standard Rates</th>
                                                   
                                            
                                              
                                                
                                                      <th class="" colspan="2" align="center" style="background-color;">Relationship Rates<a style="cursor: pointer;" class="currentRatesAnchor"><sup>[1]</sup></a> with Performance Checking</th>
                                                   
                                                   
                                            
                                              
                                                
                                                      <th class="" colspan="2" align="center" style="background-color;">Relationship Rates<a style="cursor: pointer;" class="currentRatesAnchor"><sup>[1]</sup></a> with Performance Select Checking</th>
                                                   
                                                   
                                               
                                           </tr>	                        	
                                            <tr class="b rowDataMM indent8"> 
                                                <td width="28%">Balance to Earn Interest</td>
                                                <td width="12%">Interest Rate</td>
                                                <td width="12%">APY<a style="cursor: pointer;" class="currentRatesAnchor"><sup>[2]</sup></a></td>
                                                <td width="12%" style="background-color;">Interest Rate</td>
                                                <td width="12%" style="background-color;">APY<a style="cursor: pointer;" class="currentRatesAnchor"><sup>[2]</sup></a></td>
                                                <td width="12%" style="background-color;">Interest Rate</td>
                                                <td width="12%" style="background-color;">APY<a style="cursor: pointer;" class="currentRatesAnchor"><sup>[2]</sup></a></td>
                                            </tr>
                                            
                                             
                                            <tr class="indent8 rowDataMM">
                                                    <td>
                                                        $1.00 
                                                        
                                                            
                                                             - $9,999.99
                                                            
                                                    </td>
                                                                                    
                                             
                                                        
                                                
                                                <td class="interestRateDiv" style="">0.03%</td>
                                                <td class="interestRateDiv" style="">0.03%</td> 
                                                    
                                                
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                            
                                                                                    
                                             
                                                        
                                                    
                                                                                    
                                                    <td class="interestRateDiv" style="background-color;">0.55%</td>
                                                    <td class="interestRateDiv" style="background-color;">0.55%</td> 		
                                                
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                            
                                                                                    
                                             
                                                        
                                                    
                                                                                    
                                                    <td class="interestRateDiv" style="background-color;">1.34%</td>
                                                    <td class="interestRateDiv" style="background-color;">1.35%</td> 		
                                                
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                            
                                            
                                                </tr>
                                            
                                         
                                            <tr class="indent8 rowDataMM">
                                                    <td>
                                                        $10,000.00 
                                                        
                                                            
                                                             - $24,999.99
                                                            
                                                    </td>
                                                                                    
                                             
                                                
                                             
                                                        
                                                
                                                <td class="interestRateDiv" style="">0.09%</td>
                                                <td class="interestRateDiv" style="">0.09%</td> 
                                                    
                                                
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                            
                                                                                    
                                             
                                                
                                             
                                                        
                                                    
                                                                                    
                                                    <td class="interestRateDiv" style="background-color;">0.55%</td>
                                                    <td class="interestRateDiv" style="background-color;">0.55%</td> 		
                                                
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                            
                                                                                    
                                             
                                                
                                             
                                                        
                                                    
                                                                                    
                                                    <td class="interestRateDiv" style="background-color;">1.34%</td>
                                                    <td class="interestRateDiv" style="background-color;">1.35%</td> 		
                                                
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                            
                                            
                                                </tr>
                                            
                                         
                                            <tr class="indent8 rowDataMM">
                                                    <td>
                                                        $25,000.00 
                                                        
                                                            
                                                             - $49,999.99
                                                            
                                                    </td>
                                                                                    
                                             
                                                
                                             
                                                
                                             
                                                        
                                                
                                                <td class="interestRateDiv" style="">0.11%</td>
                                                <td class="interestRateDiv" style="">0.11%</td> 
                                                    
                                                
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                            
                                                                                    
                                             
                                                
                                             
                                                
                                             
                                                        
                                                    
                                                                                    
                                                    <td class="interestRateDiv" style="background-color;">0.60%</td>
                                                    <td class="interestRateDiv" style="background-color;">0.60%</td> 		
                                                
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                            
                                                                                    
                                             
                                                
                                             
                                                
                                             
                                                        
                                                    
                                                                                    
                                                    <td class="interestRateDiv" style="background-color;">1.54%</td>
                                                    <td class="interestRateDiv" style="background-color;">1.55%</td> 		
                                                
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                            
                                            
                                                </tr>
                                            
                                         
                                            <tr class="indent8 rowDataMM">
                                                    <td>
                                                        $50,000.00 
                                                        
                                                            
                                                             - $99,999.99
                                                            
                                                    </td>
                                                                                    
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                        
                                                
                                                <td class="interestRateDiv" style="">0.13%</td>
                                                <td class="interestRateDiv" style="">0.13%</td> 
                                                    
                                                
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                            
                                                                                    
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                        
                                                    
                                                                                    
                                                    <td class="interestRateDiv" style="background-color;">0.60%</td>
                                                    <td class="interestRateDiv" style="background-color;">0.60%</td> 		
                                                
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                            
                                                                                    
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                        
                                                    
                                                                                    
                                                    <td class="interestRateDiv" style="background-color;">1.74%</td>
                                                    <td class="interestRateDiv" style="background-color;">1.75%</td> 		
                                                
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                            
                                            
                                                </tr>
                                            
                                         
                                            <tr class="indent8 rowDataMM">
                                                    <td>
                                                        $100,000.00 
                                                        
                                                            
                                                             - $249,999.99
                                                            
                                                    </td>
                                                                                    
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                        
                                                
                                                <td class="interestRateDiv" style="">0.15%</td>
                                                <td class="interestRateDiv" style="">0.15%</td> 
                                                    
                                                
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                            
                                                                                    
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                        
                                                    
                                                                                    
                                                    <td class="interestRateDiv" style="background-color;">0.65%</td>
                                                    <td class="interestRateDiv" style="background-color;">0.65%</td> 		
                                                
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                            
                                                                                    
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                        
                                                    
                                                                                    
                                                    <td class="interestRateDiv" style="background-color;">1.83%</td>
                                                    <td class="interestRateDiv" style="background-color;">1.85%</td> 		
                                                
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                            
                                            
                                                </tr>
                                            
                                         
                                            <tr class="indent8 rowDataMM">
                                                    <td>
                                                        $250,000.00 
                                                        
                                                            
                                                             - $499,999.99
                                                            
                                                    </td>
                                                                                    
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                        
                                                
                                                <td class="interestRateDiv" style="">0.15%</td>
                                                <td class="interestRateDiv" style="">0.15%</td> 
                                                    
                                                
                                                
                                             
                                                
                                             
                                                
                                            
                                                                                    
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                        
                                                    
                                                                                    
                                                    <td class="interestRateDiv" style="background-color;">0.65%</td>
                                                    <td class="interestRateDiv" style="background-color;">0.65%</td> 		
                                                
                                                
                                             
                                                
                                             
                                                
                                            
                                                                                    
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                        
                                                    
                                                                                    
                                                    <td class="interestRateDiv" style="background-color;">1.83%</td>
                                                    <td class="interestRateDiv" style="background-color;">1.85%</td> 		
                                                
                                                
                                             
                                                
                                             
                                                
                                            
                                            
                                                </tr>
                                            
                                         
                                            <tr class="indent8 rowDataMM">
                                                    <td>
                                                        $500,000.00 
                                                        
                                                            
                                                             - $999,999.99
                                                            
                                                    </td>
                                                                                    
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                        
                                                
                                                <td class="interestRateDiv" style="">0.17%</td>
                                                <td class="interestRateDiv" style="">0.17%</td> 
                                                    
                                                
                                                
                                             
                                                
                                            
                                                                                    
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                        
                                                    
                                                                                    
                                                    <td class="interestRateDiv" style="background-color;">0.65%</td>
                                                    <td class="interestRateDiv" style="background-color;">0.65%</td> 		
                                                
                                                
                                             
                                                
                                            
                                                                                    
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                        
                                                    
                                                                                    
                                                    <td class="interestRateDiv" style="background-color;">1.83%</td>
                                                    <td class="interestRateDiv" style="background-color;">1.85%</td> 		
                                                
                                                
                                             
                                                
                                            
                                            
                                                </tr>
                                            
                                         
                                            <tr class="indent8 rowDataMM">
                                                    <td>
                                                        $1,000,000.00 
                                                        
                                                             and above
                                                            
                                                            
                                                    </td>
                                                                                    
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                        
                                                
                                                <td class="interestRateDiv" style="">0.17%</td>
                                                <td class="interestRateDiv" style="">0.17%</td> 
                                                    
                                                
                                                
                                            
                                                                                    
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                        
                                                    
                                                                                    
                                                    <td class="interestRateDiv" style="background-color;">0.65%</td>
                                                    <td class="interestRateDiv" style="background-color;">0.65%</td> 		
                                                
                                                
                                            
                                                                                    
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                
                                             
                                                        
                                                    
                                                                                    
                                                    <td class="interestRateDiv" style="background-color;">1.83%</td>
                                                    <td class="interestRateDiv" style="background-color;">1.85%</td> 		
                                                
                                                
                                            
                                            
                                                </tr>
                                            
                                        
                                        </tbody></table>
                                    
                                        
                                
                            
                            
                        </div>
                        
                </div>
            </div>
        </div>
        </div>
        </div>
                    <!-- ********************** -->
                    <!-- Begin Promotional Rates for Money Market -->
                    <!-- ********************** -->
        <!-- 
        <div class="accordion-parsys limited-parsys">
                        <div class="accordion section noPadding">
                            <div class="accordion-elements-parsys elements">
                                <div class="accordion-element section collapsed" id="promotionalRatesBlockMoneyMarket">
                                    <a name="promotionalRate" id="promotionalRate"></a>
                                    <h3 class="subheading">
                                    Promotional Rates
                                    <span class="toggle"></span>
                                    <span class="toggle"></span></h3>
                                    <div class="accordion-content" data-expanded="true" style="display: none;">
                                
                                <div>
                                <table cellpadding="0" cellspacing="0">
                                       <tr>
                                     <th class="l orangeText"><span style="color: #f38025;font-size:15px ;font-weight:bold">Premiere Money Market Account</span></th>     						
                                      </tr>
                                 </table>
                                </div> 
                                
            <table cellpadding="0" cellspacing="0">
                        
                                
                                
                                <tr>
                                      <td><p style="float: left;" class="disclosureText">There are no promotional rates available for display.</p></td>
                                        </tr>
                                
                            
                        
                        </table>
                </div>
            </div>
        </div>
        </div>
        </div>
        -->
        
        
                        <a id="moneyMarketNote2">&nbsp;</a>	 					
        <div id="disclosureMM" style="">
                            <!-- check for Money Market Relatioship product to determine if the disclosure needs to be shown-->
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        <p class="disclosure">1. In order to qualify for a Relationship Rate on Premiere Money Market, you must have a linked checking account (for the Performance Checking Relationship Rate, you must have a linked Performance Checking or Virtual Wallet® with Performance Spend; for the Performance Select Checking Relationship Rate, you must have a linked Performance Select Checking or Virtual Wallet with Performance Select) and meet one of the following requirements:
        </p>
        <ul class="ulDisclosure noPadding">
        <li>•	Make a combination of 5 or more PIN and/or signature point-of-sale transactions (excluding cash advances) posted during the previous calendar month to your Checking account using your Visa® Debit Card or to your linked Visa Credit Card.</li>
        <li>•	Have $2,000 in qualifying direct deposits ($1,000 for WorkPlace or Military Banking customers) in a linked Virtual Wallet with Performance Spend or Performance Checking during the previous calendar month.</li>
        <li>•	Have $5,000 in qualifying direct deposits in a linked Virtual Wallet with Performance Select or Performance Select Checking during the previous calendar month.</li>
        </ul>
        <p class="disclosure">Starting with the calendar month following when you open your Premiere Money Market account and monthly thereafter, whether the account earns the variable Standard or Relationship Rate for the entire calendar month will be determined on the first of the month based upon the number of qualifying transactions or direct deposit requirement from the previous calendar month.
        </p>
        <p class="disclosure">If there are changes to your linked checking account (it is closed, changed to a new account type or no longer linked to your Premiere Money Market account), you may no longer qualify for a Relationship Rate, or the rates may otherwise change to those in effect at the time of the change.
        </p> 
        <p class="disclosure"><b>Important Note:</b> Your Premiere Money Market account will earn the highest rate available to you (Rate Offer, Standard or Relationship Rate) for which you qualify based on the applicable balance tier and the criteria above.
        </p>
        <p class="disclosure"> 2. Annual Percentage Yield (APY) accurate as of 11/22/2018. Rates may change after account is opened. Fees may reduce earnings.</p>
        
        <p class="disclosure">Federal regulation prohibits you from making
        more than a total of 6 transfers each month to other accounts from a
        savings or money market account (including transfers to another account
        for overdraft protection) or to third parties each month by check,
        through point-of-sale purchase transactions with a banking card, by
        preauthorized or automatic agreements, telephone, or online. See your
        account agreement for more information. Other limits may apply to your
        account. Excessive transactions may result in changing your Money
        Market or Savings account to a non-interest bearing checking account.</p>
        
        
                        
        </div>
        
                     <a id="moneyMarketPromo">&nbsp;</a> 
        <div id="disclosureMMPromo" style="display:none;">
                            <p class="disclosure">1.In order to qualify for a Relationship Rate
        on Premiere Money Market, you must have a linked checking account (for
        the Performance Checking Relationship Rate, you must have a linked
        Performance Checking or Virtual Wallet® with Performance Spend; for the
        Performance Select Checking Relationship Rate, you must have a linked
        Performance Select Checking or Virtual Wallet with Performance Select)
        and meet one of the following requirements:</p>
        <ul class="ulDisclosure noPadding">
        <li>• Make a combination of 5 or more PIN and/or signature
        point-of-sale transactions (excluding cash advances) posted during the
        previous calendar month to your Checking account using your Visa®
        Debit Card or to your linked Visa Credit Card.</li>
        <li>• Have $2,000 in qualifying direct deposits ($1,000 for
        WorkPlace or Military Banking customers) in a linked Virtual Wallet
        with Performance Spend or Performance Checking during the previous
        calendar month.</li>
        <li>• Have $5,000 in qualifying direct deposits in a linked
        Virtual Wallet with Performance Select or Performance Select Checking
        during the previous calendar month.</li>
        </ul>
        <p class="disclosure">Starting with the calendar month following
        when you open your Premiere Money Market account and monthly
        thereafter, whether the account earns the variable Standard or
        Relationship Rate for the entire calendar month will be determined on
        the first of the month based upon the number of qualifying transactions
        or direct deposit requirement from the previous calendar month.</p>
        <p class="disclosure">If there are changes to your linked checking
        account (it is closed, changed to a new account type or no longer
        linked to your Premiere Money Market account), you may no longer
        qualify for a Relationship Rate, or the rates may otherwise change to
        those in effect at the time of the change.</p>
        <p class="disclosure">
        <b>Important Note:</b> Your Premiere Money Market account will earn the
        highest rate available to you (Rate Offer, Standard or Relationship
        Rate) for which you qualify based on the applicable balance tier and
        the criteria above.
        </p>
        
        
                        
        
        
        <p class="disclosure">
            2. Annual Percentage Yield (APY) accurate as of
            11/22/2018.
            Rates may change after account is opened. Fees may reduce earnings.
        </p>
        
        
        
        
        
        
        
        
        
        
        
        
        <p class="disclosure">Federal regulation prohibits you from making
        more than a total of 6 transfers each month to other accounts from a
        savings or money market account (including transfers to another account
        for overdraft protection) or to third parties each month by check,
        through point-of-sale purchase transactions with a banking card, by
        preauthorized or automatic agreements, telephone, or online. See your
        account agreement for more information. Other limits may apply to your
        account. Excessive transactions may result in changing your Money
        Market or Savings account to a non-interest bearing checking account.</p>
        
        
        
        </div>  	
                        
                    </div>`
    }
};

//https://medium.com/@e_mad_ehsan/getting-started-with-puppeteer-and-chrome-headless-for-web-scrapping-6bf5979dee3e
//https://github.com/GoogleChrome/puppeteer/blob/master/docs/api.md
//https://codeburst.io/a-guide-to-automating-scraping-the-web-with-javascript-chrome-puppeteer-node-js-b18efb9e9921
//https://github.com/checkly/puppeteer-examples#2-search
//https://www.aymen-loukil.com/en/blog-en/google-puppeteer-tutorial-with-examples/
//https://browsee.io/blog/puppeteer-how-to-find-a-link-element-with-a-certain-text/
//https://stackoverflow.com/questions/47821995/how-to-click-on-a-link-that-has-a-certain-content-in-puppeteer

//issues:
//PDFs
//zip codes

const puppeteer = require('puppeteer');
//const mysql     = require('mysql');
//const cheerio   = require('cheerio');
const toolPage  = 'file:///C:/Users/Rob/Training/scraping/tests/HQ%20Finance%20Deposits(CPS)%20__%20Tools.html';
//const creds     = require('./creds.json');
const path = require('path');
const { createLogger, format, transports } = require('winston');
const { combine, timestamp, label, printf } = format;
//dom element selectors
const usernameSelector = '#login_form input[name="username"]';
const passwordSelector = '#password';
const buttonSelector   = '#login_button'; 
const nameHeaderSelector = '#rate-table > thead > tr.table_header > th.merch-name.header';
const rateTableRows    = '#rate-table > tbody > tr';
const bank1stCharStart = 'P'; 
const banklastCharStart  = 'V';
const pauseExeptions = [
    'American Express National Bank', 
    'BBVA Compass (Rate in CA)', 
    'TTIA Direct'
];

let missingUrls = 0;

async function run() {
    const logger = createLogger({
        transports: [
          new transports.Console(),
          new transports.File({ filename: 'deposit_rates.log' })
        ],
        format: format.splat()
    });

    logger.log('info', 'Process started.');
    const browser = await puppeteer.launch({
        headless: false //,
        //slowMo: 250 // slow down by 250ms
    });

    const toolTab = await browser.newPage();
    await toolTab.setViewport({ width: 1566, height: 768});

    logger.info('Going to Tool page');
    await toolTab.goto(toolPage);
    await toolTab.waitFor(2000);

    logger.info('Sorting Banks');

    await toolTab.click(nameHeaderSelector);
    await toolTab.waitFor(3000);

    //one more time
    await toolTab.click(nameHeaderSelector);
    await toolTab.waitFor(3000);

    //let content = await toolTab.content();
    //let $ = cheerio.load(content);

    /*
    logger.log('Connecting to mysql');
    const con = mysql.createConnection({
        host: "localhost",
        user: creds.db.username,
        password: creds.db.password
    });

    async function moveRow(rowId, firstRowId, bgColor) {
        await toolTab.evaluate((id, firstRowId, bgColor) => { 
            $('#'+id).insertBefore($('tr#'+firstRowId)).children('td').css('background-color', bgColor);
        }, rowId, firstRowId, bgColor);
    }

    */
    async function moveRows(rowId, url, firstRowId, bgColor) {
        await toolTab.evaluate((id, url, firstRowId, bgColor) => { 
            debugger;
            $('tr#'+id)
                .siblings(':contains("'+url+'")')
                .insertBefore($('tr#'+firstRowId))
                    .children('td')
                    .css('background-color', bgColor);
        }, rowId, url, firstRowId, bgColor);
    }


    //con.connect(err => {
    //    if (err) throw err;
        logger.info("Connected! Opening new tab");
        const bankTab = await browser.newPage();

        logger.info('Fetching relevant banks');
        //get relevant bank
        const banks = await toolTab.$$eval('#rate-table tbody tr', (trs, bank1stCharStart, banklastCharStart) => {
            return trs.filter( tr => {
                let bankName = tr.querySelector('td.merch-name').textContent;
                let updateFrequency = tr.querySelector('td.update_frequency_txt').textContent;
                let bank1stChar = bankName.charAt(0).toUpperCase();
                
                return bank1stChar >= bank1stCharStart && bank1stChar <= banklastCharStart
                    && (updateFrequency.toLowerCase !== 'paused' || pauseExeptions.includes(bankName));
            }).map(bank => { 
                return {
                    rowid: bank.getAttribute('id'),
                    name:  bank.querySelector('td.merch-name').textContent,
                    note:  bank.querySelector('td.note').textContent,
                    url:   bank.querySelector('.merch-link > span').textContent
                }
            });
        }, bank1stCharStart, banklastCharStart, pauseExeptions);
        
        logger.info('Got %d banks.', banks.length);

        //let $ = cheerio.load(rows.join(''));
        //let $tr = $('tr');
        const firstRowId = await toolTab.$$eval('#rate-table tbody tr:first-of-type', tr => tr[0].id);

        for(let bank of banks) {
            if (path.extname(bank.url) === '.pdf') {
                //don't check pdfs for phase 1
                moveRows(bank.rowid, bank.url, firstRowId, '#AED6F1');
            }
            else if (bank.note.includes('Rate collected within')) {
                //don't process zipcodes and states for phase 1
                moveRows(bank.rowid, bank.url, firstRowId, '#A9DFBF');
            } else {
                //check for changes
                let bankInfo  = data[bank.url];
                if (bankInfo) {
                    logger.info(`Checking ${bank.name} for changes`);
                    await bankTab.goto(bank.url); 
                    await bankTab.waitFor(2000);
                    const contentHandle = await bankTab.$(bankInfo.selector);
                    const content = await bankTab.evaluate(content => content.innerHTML, contentHandle);
                    await contentHandle.dispose();
                    //let content = await bankTab.$$eval(bankInfo.selector, content => content[0].outerHTML);
                    if (bankInfo.content.trim() == content.trim()) {
                        //re-save it
                        logger.info(`${bank.name} has not changed. Resaving.`);
                        let linkSelector = `td#${bank.rowid}-controls > a:nth-child(1)`;
                        logger.info(`Clicking edit link.`);
                        await toolTab.click(linkSelector);
                        await toolTab.waitFor(3000);
                        logger.info(`Clicking save link.`);
                        await toolTab.click(linkSelector);
                        await toolTab.waitFor(3000);
                        await toolTab.evaluate((id, linkSelector) => { 
                            $('tr#'+id).children('td').css('background-color', bgColor);
                            $(linkSelector).remove();
                        }, rowId, linkSelector);
                        //move all of the rows with the same link to the top of the page
                        moveRows(bank.rowid, bank.url, firstRowId, '#566573');
                    }
                    else {
                        logger.info(`${bank.name} has changed!`);
                        moveRows(bank.rowid, bank.url, firstRowId, '#566573');
                    }
                } 
                else {
                    missingUrls++;
                    logger.warn('No record of %s in db. Add it!', bank.name);
                    continue;
                }
            }
        };
       
        logger.info('Processing completed. Of %d bank rows, %d URLs were missing from the DB.', banks.length, missingUrls);

   // con.end();

    //setTimeout(async () => {
    //    await browser.close();
    //}, 60000 * 4);
}
run();
